# Flatpak

The [OpenMadoola Flatpak](https://flathub.org/apps/com.infochunk.OpenMadoola) has a few differences from the standard binary due to sandboxing.

## Data files

All redistributable data files from this repo are bundled with the Flatpak, similar to the Windows builds. When you run the OpenMadoola Flatpak for the first time, a script will walk you through loading your Wing of Madoola game ROM data.

All files generated by you playing the game (saves, configuration information, etc.) are stored at `~/.var/app/com.infochunk.OpenMadoola/data/openmadoola/`.

## Steam Deck

Playing OpenMadoola on the Steam Deck requires a slightly convoluted process at the moment due to how the Steam Deck handles input in desktop mode. I will look at making this smoother in future updates.

1. Go into desktop mode and install OpenMadoola through Discover.
2. Run OpenMadoola in desktop mode and follow the process to load the game ROM.
3. Once you've loaded the ROM and see the title screen, quit OpenMadoola.
4. Right-click the OpenMadoola shortcut and click "Add to Steam".
5. Click "Return to Gaming Mode".
6. From here on out, run OpenMadoola from the "non-Steam" section of your library.

This is necessary because when you're in desktop mode, the gamepad buttons on the Steam Deck will send both both keyboard inputs and gamepad inputs at the same time. If you try to remap your controls while in desktop mode, you will probably mess up your key bindings because the simultaneous keyboard and gamepad inputs interfere with the key mapping process. If you already made this mistake, delete the "config.db" file from `~/.var/app/com.infochunk.OpenMadoola/data/openmadoola/` to restore the key bindings to default. In case you're wondering, you can't go through the ROM installation process when you're in gaming mode because it involves a script that launches a pop-up file chooser, and this doesn't work properly in the single-tasking Gamescope window manager used by gaming mode.

## MML compiler

Due to sandboxing, you can only play MML files that are in `~/.var/app/com.infochunk.OpenMadoola/data/openmadoola/`. If you're working on an MML file and want to use the standalone player, copy the file into that directory, then open a terminal there. You can play the MML file by running `flatpak run com.infochunk.OpenMadoola -p file.mml`. If you're interested in overriding in-game music or sounds with your MML file, create the directory `~/.var/app/com.infochunk.OpenMadoola/data/openmadoola/mml` and then copy your files inside that directory following the names [here](https://github.com/nfroggy/openmadoola/blob/master/src/sound.c) (search for "soundFilenames").
